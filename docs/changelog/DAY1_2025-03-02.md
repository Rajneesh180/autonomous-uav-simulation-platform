# Day 1 — Critical Pipeline Fixes & Configuration Hardening

**Date:** 2025-03-02  
**Scope:** Roadmap items A1, A3, E3 + housekeeping  
**Branch:** `main`

---

## Summary

Three targeted changes that close critical gaps identified during the Phase 1–4
codebase audit.  Together they ensure the SCA hover optimizer is **active** in
every mission, the AoI-priority coupling is **configurable** for ablation
studies, and misconfigurations are caught **before** any simulation run.

---

## Changes

### 1. Wire SCA Hover Optimizer into Mission Pipeline (A1)

**Files modified:**  
- `core/mission_controller.py`

**Problem:**  
`HoverOptimizer` was imported (line 18) but **never invoked** in
`_recompute_plan()`.  The entire SCA hover refinement contribution from
Zheng & Liu (IEEE TVT 2025, §III-E) was dead code.

**Fix:**  
- Added `self._hover_positions: dict = {}` to `__init__` for per-node hover
  coordinate storage.
- Inserted *Stage 3* in `_recompute_plan()` — after GA sequence refinement and
  before cache write-back — that calls `HoverOptimizer.apply_sequence()` when
  `Config.ENABLE_SCA_HOVER` is `True`.
- Modified `_move_one_step()` to navigate toward the SCA-refined hover position
  (if available) instead of the raw node ground coordinate.

**Impact:**  
Inter-waypoint travel cost is now minimised per the SCA gradient descent
formulation, respecting obstacle altitude constraints and hover-radius bounds.

---

### 2. Configurable AoI Urgency Weight (A3)

**Files modified:**  
- `config/config.py`
- `core/clustering/semantic_clusterer.py`

**Problem:**  
The AoI-to-priority boost was hardcoded as a `1.5×` multiplier at
`semantic_clusterer.py:53`.  This is not scientifically defensible in a
research-grade codebase — the weight should be an ablation parameter.

**Fix:**  
- Added `AOI_URGENCY_WEIGHT = 1.5` to `Config` (Phase 3.5 section).
- Replaced the literal `1.5` in `SemanticClusterer.build_feature_matrix()` with
  `Config.AOI_URGENCY_WEIGHT`.

**Impact:**  
Sweeping `AOI_URGENCY_WEIGHT ∈ {0, 0.5, 1.0, 1.5, 2.0, 3.0}` is now trivial
for ablation experiments measuring the AoI–DR% trade-off.

---

### 3. Configuration Validation Layer (E3)

**Files modified:**  
- `config/config.py`
- `main.py`

**Problem:**  
No pre-flight assertion checks existed.  Invalid parameter combinations
(e.g. `BATTERY_CAPACITY ≤ 0`, `GA_POPULATION_SIZE < 4`) would silently
produce garbage results or cryptic runtime errors.

**Fix:**  
- Added `Config.validate()` classmethod with 25+ domain-specific assertions
  covering map geometry, energy model, communication, SCA, GA, temporal engine,
  AoI/sensing, clustering, motion model, hostility, RP selection, node energy,
  and base-station uplink.
- Wired `Config.validate()` into `main.py` immediately after toggle and
  hostility-profile application but before the first simulation call.

**Impact:**  
Misconfigurations now raise a descriptive `ValueError` with all failing
constraints enumerated, preventing silent corruption of experimental results.

---

### 4. Housekeeping

- Purged 7 project-level `__pycache__/` directories.
- Removed `results/legacy/` (≈ 146 MB of stale Phase 1–2 artefacts).
- Cleared `.DS_Store` files.

---

## Verification

- [ ] `python main.py --mode single` completes without `ValueError`
- [ ] Console shows `[SCA Hover] Refined N hover positions` during replanning
- [ ] `Config.validate()` raises on intentionally invalid configs
- [ ] 10-run batch baseline (`--mode batch`) produces new metrics
